---
import type { GetStaticPaths } from "astro";
import BaseHead from "../../../components/BaseHead.astro";
import Footer from "../../../components/Footer.astro";
import Header from "../../../components/Header.astro";
import FormattedDate from "../../../components/FormattedDate.astro";
import { SITE_DESCRIPTION, SITE_TITLE } from "../../../consts";
import { getSortedPosts } from "../../../lib/posts";
import { categories } from "../../../content/meta/categories";

export const getStaticPaths = (async ({ paginate }) => {
  const posts = await getSortedPosts();
  const allTags = [...new Set(posts.flatMap((post) => post.data.tags || []))];

  return allTags.flatMap((tag) => {
    const filteredPosts = posts.filter((post) => post.data.tags?.includes(tag));
    return paginate(filteredPosts, {
      params: { tag },
      pageSize: 10,
      props: { tagName: tag },
    });
  });
}) satisfies GetStaticPaths;

const { page, tagName } = Astro.props;
---

<!doctype html>
<html lang="de">
  <head>
    <BaseHead
      title={`Tag: ${tagName} | ${SITE_TITLE}`}
      description={SITE_DESCRIPTION}
    />
    <style>
      main {
        width: 100%;
        max-width: 960px;
        margin: 0 auto;
        padding: 0 1rem;
      }
      .blog-hero {
        padding: 4rem 0;
        text-align: center;
      }
      .blog-hero h1 {
        font-size: 3rem;
        margin-bottom: 1rem;
        font-family: "Georgia", serif;
      }
      .post-list {
        list-style: none;
        padding: 0;
        display: grid;
        gap: 3rem;
      }
      .post-item {
        border-bottom: 1px solid var(--gray-light);
        padding-bottom: 3rem;
      }
      .post-item:last-child {
        border-bottom: none;
      }
      .post-meta {
        font-size: 0.9rem;
        color: var(--gray);
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-family: "Atkinson", sans-serif;
      }
      .category {
        color: var(--accent);
        font-weight: bold;
        margin-right: 1rem;
      }
      .post-title {
        font-size: 2rem;
        margin: 0.5rem 0 1rem;
        font-family: "Georgia", serif;
      }
      .post-title a {
        color: rgb(var(--black));
        text-decoration: none;
      }
      .post-title a:hover {
        color: var(--accent);
      }
      .post-excerpt {
        font-size: 1.1rem;
        line-height: 1.6;
        color: var(--gray-dark);
        margin-bottom: 1.5rem;
      }
      .read-more {
        color: var(--accent);
        text-decoration: none;
        font-weight: bold;
      }
      .pagination {
        display: flex;
        justify-content: center;
        gap: 2rem;
        margin-top: 4rem;
        padding-top: 2rem;
        border-top: 1px solid var(--gray-light);
      }
      .pagination a {
        text-decoration: none;
        color: var(--black);
        font-weight: bold;
        padding: 0.5rem 1rem;
        border: 1px solid var(--gray-light);
        border-radius: 4px;
        transition: all 0.2s;
      }
      .pagination a:hover {
        border-color: var(--accent);
        color: var(--accent);
      }
    </style>
  </head>
  <body>
    <Header />
    <main>
      <section class="blog-hero">
        <span
          style="text-transform: uppercase; letter-spacing: 0.1em; color: var(--gray);"
          >Tag</span
        >
        <h1>{tagName}</h1>
      </section>

      <ul class="post-list">
        {
          page.data.map((post) => (
            <li class="post-item">
              <div class="post-meta">
                <span class="category">{categories[post.data.category]}</span>
                <FormattedDate date={post.data.date} />
              </div>
              <h2 class="post-title">
                <a href={`/blog/${post.data.slug || post.id}/`}>
                  {post.data.title}
                </a>
              </h2>
              <p class="post-excerpt">{post.data.excerpt}</p>
              <a href={`/blog/${post.data.slug || post.id}/`} class="read-more">
                Weiterlesen &rarr;
              </a>
            </li>
          ))
        }
      </ul>

      <nav class="pagination">
        {
          page.url.prev ? (
            <a href={page.url.prev}>&larr; Neuere Artikel</a>
          ) : null
        }
        {
          page.url.next ? (
            <a href={page.url.next}>Ã„ltere Artikel &rarr;</a>
          ) : null
        }
      </nav>
    </main>
    <Footer />
  </body>
</html>
